<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OrchestrationApi - 仪表板</title>

    <!-- Favicon 配置 - 添加版本号防止缓存 -->
    <link rel="icon" href="/favicon.png?v=2" type="image/png">
    <link rel="shortcut icon" href="/favicon.ico?v=2" type="image/x-icon">
    <link rel="apple-touch-icon" href="/favicon.png?v=2" />

    <!-- 早期认证检查脚本 - 在页面渲染前执行 -->
    <script>
        // 立即检查认证状态，避免显示未授权内容
        (function() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                // 没有token，立即跳转到登录页
                window.location.href = '/login';
                return;
            }

            // 有token，但需要验证其有效性
            // 使用同步方式快速检查token格式和过期时间
            try {
                // 简单的JWT token格式检查
                const parts = token.split('.');
                if (parts.length !== 3) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('tokenExpires');
                    window.location.href = '/login';
                    return;
                }

                // 检查本地存储的过期时间
                const tokenExpires = localStorage.getItem('tokenExpires');
                if (tokenExpires) {
                    const expiresAt = new Date(tokenExpires);
                    const now = new Date();
                    if (now >= expiresAt) {
                        // token已过期
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('tokenExpires');
                        window.location.href = '/login';
                        return;
                    }
                }

                // token格式正确且未过期，继续加载页面
                // 详细的服务器端验证将在Alpine.js初始化时进行
            } catch (error) {
                // token解析失败，清理并跳转
                localStorage.removeItem('authToken');
                localStorage.removeItem('tokenExpires');
                window.location.href = '/login';
                return;
            }
        })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/dashboard.css">
</head>

<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8" x-data="multiProviderDashboard()">
        <!-- Header -->
        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-8 space-y-4 lg:space-y-0">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
                    OrchestrationApi 仪表板
                </h1>
                <p class="text-gray-600 text-sm md:text-base">管理多个AI服务商和密钥，支持自动切换实现负载均衡</p>
            </div>

            <!-- 移动端优化的按钮区域 -->
            <div class="flex flex-col space-y-3 lg:space-y-0">
                <!-- 用户信息显示 -->
                <div class="text-gray-600 text-sm text-center lg:text-right">
                    欢迎回来，<span x-text="user.username" class="font-medium text-gray-800"></span>
                    <span x-text="user.role ? `(${user.role})` : ''" class="text-gray-500"></span>
                </div>

                <!-- 响应式按钮组 -->
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 lg:gap-4">
                    <!-- 账户设置按钮 -->
                    <button @click="showUserSettingsModal = true"
                        class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center space-x-2 text-sm"
                        title="账户设置">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <span>账户设置</span>
                    </button>
                    <a href="/logs"
                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 text-center text-sm">
                        <span>请求日志</span>
                    </a>
                    <a href="/health-report"
                        class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 text-center text-sm">
                        <span>健康检查结果</span>
                    </a>
                    <button @click="refreshData()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 text-sm">
                        <span>刷新数据</span>
                    </button>
                    <button onclick="logout()"
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 text-sm">
                        登出
                    </button>
                </div>
            </div>
        </div>

        <!-- System Overview - 第一排 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <!-- 系统状态与运行时间 -->
            <div
                class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 rounded-lg flex items-center justify-center bg-green-100">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">
                                系统状态
                            </p>
                            <p class="text-xl font-bold text-green-600">
                                运行中
                            </p>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-2">
                        <button @click="refreshAllHealth()" :disabled="loadingHealthRefresh"
                            class="inline-flex items-center justify-center px-2 sm:px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-green-700 bg-green-100 hover:bg-green-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 transition-all duration-200">
                            <svg x-show="!loadingHealthRefresh" class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                                </path>
                            </svg>
                            <svg x-show="loadingHealthRefresh" class="animate-spin w-3 h-3 mr-1" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <span x-show="!loadingHealthRefresh">健康检查</span>
                            <span x-show="loadingHealthRefresh">检查中</span>
                        </button>
                        <button @click="loadSystemHealth()" :disabled="loadingSystemHealth"
                            class="inline-flex items-center justify-center px-2 sm:px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 transition-all duration-200">
                            <svg x-show="!loadingSystemHealth" class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                </path>
                            </svg>
                            <svg x-show="loadingSystemHealth" class="animate-spin w-3 h-3 mr-1" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <span x-show="!loadingSystemHealth">刷新</span>
                            <span x-show="loadingSystemHealth">刷新中</span>
                        </button>
                    </div>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">运行时间</span>
                        <span class="font-medium" x-text="formatDuration(systemHealth.uptime)">-</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">启动时间</span>
                        <span class="font-medium" x-text="formatDate(systemHealth.start_time)">-</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-500">版本信息</span>
                        <div class="flex items-center space-x-2">
                            <span class="font-medium" x-text="systemHealth.version || 'v1.0.0'">v1.0.0</span>
                            <!-- 版本更新提示 -->
                            <template x-if="versionInfo && versionInfo.hasNewVersion">
                                <button @click="openReleaseUrl()"
                                    class="inline-flex items-center px-2 py-1 text-xs font-medium text-blue-700 bg-blue-100 border border-blue-200 rounded-md hover:bg-blue-200 transition-colors duration-200"
                                    :title="`有新版本 ${versionInfo.latestVersion} 可用`">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10">
                                        </path>
                                    </svg>
                                    新版本
                                </button>
                            </template>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 服务商分组 -->
            <div
                class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">
                                服务商分组
                            </p>
                            <p class="text-xl font-bold text-blue-600" x-text="systemHealth.total_groups || 0"></p>
                        </div>
                    </div>
                    <button @click="loadProviderStatuses()" :disabled="loadingProviderStatuses"
                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50 transition-all duration-200">
                        <svg x-show="!loadingProviderStatuses" class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        <svg x-show="loadingProviderStatuses" class="animate-spin w-3 h-3 mr-1" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <span x-show="!loadingProviderStatuses">刷新</span>
                        <span x-show="loadingProviderStatuses">刷新中</span>
                    </button>
                </div>
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">启用分组</span>
                        <span class="font-medium text-green-600" x-text="systemHealth.enabled_groups || 0">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">禁用分组</span>
                        <span class="font-medium text-red-600" x-text="systemHealth.disabled_groups || 0">0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-500">总密钥数</span>
                        <span class="font-medium" x-text="systemHealth.total_keys || 0">0</span>
                    </div>
                </div>
            </div>

        </div>

        <!-- API密钥状态 - 第二排 -->
        <div class="mb-8">
            <div
                class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-all duration-200">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2m0 0V7a2 2 0 012-2h4zm-6 2v6h4V9H9z">
                                    </path>
                                </svg>
                            </div>
                        </div>
                        <div class="ml-4">
                            <p class="text-lg font-semibold text-gray-800">
                                API密钥状态
                            </p>
                            <p class="text-sm text-gray-500" x-show="keyStatus.last_updated">
                                更新于
                                <span x-text="keyStatus.last_updated"></span>
                            </p>
                            <p class="text-sm text-gray-400" x-show="!keyStatus.last_updated">
                                点击"手动检测"获取最新状态
                            </p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button @click="refreshKeyStatus()" :disabled="loadingKeyStatus"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-purple-700 bg-purple-100 hover:bg-purple-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 transition-all duration-200">
                            <svg x-show="!loadingKeyStatus" class="w-4 h-4 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                </path>
                            </svg>
                            <svg x-show="loadingKeyStatus" class="animate-spin w-4 h-4 mr-2" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <span x-show="!loadingKeyStatus">实时状态</span>
                            <span x-show="loadingKeyStatus">获取中...</span>
                        </button>
                        <button @click="loadPersistedValidationStatus()" :disabled="loadingValidation"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 transition-all duration-200">
                            <svg x-show="!loadingValidation" class="w-4 h-4 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <svg x-show="loadingValidation" class="animate-spin w-4 h-4 mr-2" fill="none"
                                viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                    stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor"
                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                </path>
                            </svg>
                            <span x-show="!loadingValidation">检查所有密钥</span>
                            <span x-show="loadingValidation">检查中...</span>
                        </button>
                    </div>
                </div>

                <!-- 密钥统计 -->
                <div class="grid grid-cols-3 gap-8">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <div class="w-6 h-6 bg-green-500 rounded-full"></div>
                        </div>
                        <div class="text-2xl font-bold text-green-600 mb-1" x-text="keyStatus.total_valid || 0">
                            0
                        </div>
                        <div class="text-sm text-gray-500">有效密钥</div>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <div class="w-6 h-6 bg-red-500 rounded-full"></div>
                        </div>
                        <div class="text-2xl font-bold text-red-600 mb-1" x-text="keyStatus.total_invalid || 0">
                            0
                        </div>
                        <div class="text-sm text-gray-500">无效密钥</div>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <div class="w-6 h-6 bg-gray-500 rounded-full"></div>
                        </div>
                        <div class="text-2xl font-bold text-gray-600 mb-1" x-text="keyStatus.total_keys || 0">
                            0
                        </div>
                        <div class="text-sm text-gray-500">总计</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Provider Groups Status -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-6 space-y-4 lg:space-y-0">
                <h2 class="text-xl font-bold">服务商分组状态</h2>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-2">
                    <button @click="openCreateGroupModal()"
                        class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        <span>添加分组</span>
                    </button>
                    <button @click="exportGroups()"
                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        <span>导出配置</span>
                    </button>

                    <button @click="showImportModal = true"
                        class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10">
                            </path>
                        </svg>
                        <span>导入配置</span>
                    </button>
                    <!-- <button @click="refreshProviderHealth()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                            </path>
                        </svg>
                        <span>刷新健康状态</span>
                    </button> -->
                    <button @click="clearInvalidKeys()" :disabled="clearingInvalidKeys"
                        class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg x-show="clearingInvalidKeys" class="animate-spin w-4 h-4 mr-2" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <svg x-show="!clearingInvalidKeys" class="w-4 h-4 mr-2" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                        <span x-show="!clearingInvalidKeys">清除无效密钥</span>
                        <span x-show="clearingInvalidKeys">处理中...</span>
                    </button>
                    <button @click="clearEmptyGroups()" :disabled="clearingEmptyGroups"
                        class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 sm:px-4 rounded-lg transition duration-200 flex items-center justify-center text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg x-show="clearingEmptyGroups" class="animate-spin w-4 h-4 mr-2" fill="none"
                            viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <svg x-show="!clearingEmptyGroups" class="w-4 h-4 mr-2" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 13h6m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        <span x-show="!clearingEmptyGroups">清除空白分组</span>
                        <span x-show="clearingEmptyGroups">处理中...</span>
                    </button>

                </div>
            </div>

            <!-- 密钥状态图例 -->
            <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                <div class="flex items-center justify-between">
                    <span class="text-sm font-medium text-gray-700">密钥状态图例：</span>
                    <div class="flex items-center space-x-6">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                            <span class="text-xs text-gray-600">有效</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                            <span class="text-xs text-gray-600">无效</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                            <span class="text-xs text-gray-600">未检测</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 搜索和筛选 -->
            <div class="mb-6 flex flex-col sm:flex-row gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <input type="text" x-model="providerSearchQuery" @input="filterProviders()"
                            placeholder="搜索分组名称、服务商类型或Base URL..."
                            class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                </div>
                <div class="flex space-x-2">
                    <select x-model="providerStatusFilter" @change="filterProviders()"
                        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">所有状态</option>
                        <option value="healthy">健康</option>
                        <option value="unhealthy">异常</option>
                    </select>
                    <select x-model="providerTypeFilter" @change="filterProviders()"
                        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">所有类型</option>
                        <option value="openai">OpenAI</option>
                        <option value="openai_responses">OpenAI Responses</option>
                        <option value="gemini">Google Gemini</option>
                        <option value="anthropic">Anthropic</option>
                        <!-- <option value="openrouter">OpenRouter</option>
                        <option value="azure_openai">Azure OpenAI</option> -->
                    </select>
                    <select x-model="providerEnabledFilter" @change="filterProviders()"
                        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">所有状态</option>
                        <option value="enabled">启用</option>
                        <option value="disabled">禁用</option>
                    </select>
                </div>
            </div>

            <!-- 服务商列表 -->
            <div class="space-y-3">
                <template x-for="(provider, groupId) in paginatedProviders" :key="groupId">
                    <div class="border rounded-lg p-3 hover:shadow-md transition-shadow"
                        :class="getProviderCardClass(provider)">
                        <!-- 移动端优化的响应式布局 -->
                        <div
                            class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-3 lg:space-y-0">
                            <!-- 左侧信息区 -->
                            <div
                                class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 flex-1 min-w-0">
                                <!-- 第一行：基本信息 -->
                                <div class="flex items-center space-x-3 min-w-0">
                                    <input type="checkbox" :value="groupId" x-model="selectedGroups"
                                        class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 flex-shrink-0" />
                                    <div class="w-3 h-3 rounded-full flex-shrink-0"
                                        :class="provider.healthy ? 'bg-green-500' : 'bg-red-500'"></div>
                                    <div class="min-w-0 flex-1">
                                        <h3 class="font-semibold text-gray-900 truncate" x-text="provider.group_name">
                                        </h3>
                                        <!-- <p class="text-sm text-gray-500 truncate" x-text="groupId"></p> -->
                                        <p class="text-xs text-gray-400 truncate" x-text="provider.base_url || '未设置'">
                                        </p>
                                    </div>
                                    <span class="text-xs px-2 py-1 rounded-full flex-shrink-0"
                                        :class="getProviderTypeClass(provider.provider_type)"
                                        x-text="provider.provider_type.toUpperCase()"></span>
                                </div>

                                <!-- 第二行：状态信息 - 移动端换行显示 -->
                                <div
                                    class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4 text-sm">
                                    <!-- 启用状态 -->
                                    <div class="flex items-center space-x-1">
                                        <span class="text-gray-600">状态:</span>
                                        <span :class="provider.enabled !== false ? 'text-green-600' : 'text-gray-500'"
                                            x-text="provider.enabled !== false ? '启用' : '禁用'"></span>
                                    </div>

                                    <!-- 健康检查状态 -->
                                    <div class="flex items-center space-x-1">
                                        <span class="text-gray-600">健康检查:</span>
                                        <span :class="provider.health_check_enabled !== false ? 'text-blue-600' : 'text-gray-400'"
                                            x-text="provider.health_check_enabled !== false ? '启用' : '禁用'"></span>
                                    </div>

                                    <!-- 密钥统计 -->
                                    <div class="flex items-center space-x-1">
                                        <span class="text-gray-600">密钥:</span>
                                        <div class="flex items-center space-x-2 flex-wrap">
                                            <!-- 总计 -->
                                            <span class="text-gray-900 font-medium"
                                                x-text="getKeyStatusData(groupId, provider).total"></span>

                                            <!-- 有效密钥 -->
                                            <div class="flex items-center space-x-1">
                                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                                <span class="text-green-600 text-xs font-medium"
                                                    x-text="getKeyStatusData(groupId, provider).valid"></span>
                                            </div>

                                            <!-- 无效密钥 -->
                                            <div class="flex items-center space-x-1"
                                                x-show="getKeyStatusData(groupId, provider).invalid > 0">
                                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                                <span class="text-red-600 text-xs font-medium"
                                                    x-text="getKeyStatusData(groupId, provider).invalid"></span>
                                            </div>

                                            <!-- 未检测 -->
                                            <div class="flex items-center space-x-1"
                                                x-show="getKeyStatusData(groupId, provider).unknown > 0">
                                                <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                                                <span class="text-gray-500 text-xs font-medium"
                                                    x-text="getKeyStatusData(groupId, provider).unknown"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 操作按钮区 - 优化PC端和移动端响应式布局 -->
                            <div
                                class="flex flex-col space-y-2 md:space-y-0 md:flex-row md:items-center md:space-x-2 lg:space-x-3 xl:space-x-4 flex-shrink-0">
                                <!-- 在小屏幕保持两行布局，在MD以上合并为一行 -->
                                <!-- 检测按钮 -->
                                <button @click="validateGroupKeys(groupId, provider)"
                                    :disabled="validatingGroups[groupId]"
                                    class="inline-flex items-center justify-center px-3 py-2 border border-purple-300 text-sm font-medium rounded text-purple-700 bg-purple-50 hover:bg-purple-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500 disabled:opacity-50 transition-colors touch-friendly whitespace-nowrap">
                                    <svg x-show="!validatingGroups[groupId]" class="w-4 h-4 sm:mr-1.5" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <svg x-show="validatingGroups[groupId]" class="animate-spin w-4 h-4 sm:mr-1.5"
                                        fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <span x-show="!validatingGroups[groupId]">检测</span>
                                    <span x-show="validatingGroups[groupId]">检测中</span>
                                </button>

                                <!-- 使用统计按钮 -->
                                <button @click="showKeyUsageStats(groupId, provider)"
                                    class="inline-flex items-center justify-center px-3 py-2 border border-indigo-300 text-sm font-medium rounded text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors touch-friendly whitespace-nowrap">
                                    <svg class="w-4 h-4 sm:mr-1.5" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                        </path>
                                    </svg>
                                    <span>使用统计</span>
                                </button>

                                <!-- 编辑按钮 -->
                                <button @click="editGroup(groupId, provider)"
                                    class="inline-flex items-center justify-center px-3 py-2 border border-transparent text-sm font-medium rounded text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors touch-friendly whitespace-nowrap">
                                    <svg class="w-4 h-4 sm:mr-1.5" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                        </path>
                                    </svg>
                                    <span>编辑</span>
                                </button>

                                <!-- 启用/禁用按钮 -->
                                <button @click="toggleGroup(groupId, provider)"
                                    class="inline-flex items-center justify-center px-3 py-2 text-sm font-medium rounded transition-colors touch-friendly whitespace-nowrap"
                                    :class="provider.enabled !== false ? 'bg-yellow-500 hover:bg-yellow-600 text-white' : 'bg-green-500 hover:bg-green-600 text-white'">
                                    <svg class="w-4 h-4 sm:mr-1.5" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path x-show="provider.enabled !== false" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2"
                                            d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        <path x-show="provider.enabled === false" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2"
                                            d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                        </path>
                                    </svg>
                                    <span x-text="provider.enabled !== false ? '禁用' : '启用'"></span>
                                </button>

                                <!-- 删除按钮 -->
                                <button @click="deleteGroup(groupId, provider)"
                                    class="inline-flex items-center justify-center px-3 py-2 border border-transparent text-sm font-medium rounded text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors touch-friendly whitespace-nowrap">
                                    <svg class="w-4 h-4 sm:mr-1.5" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                        </path>
                                    </svg>
                                    <span>删除</span>
                                </button>

                            </div>
                        </div>

                        <!-- 错误信息 -->
                        <div x-show="provider.last_error"
                            class="mt-3 p-2 bg-red-100 border border-red-200 rounded text-sm text-red-700">
                            <strong>错误:</strong>
                            <span x-text="provider.last_error"></span>
                        </div>
                    </div>
                </template>

                <!-- 空状态 -->
                <div x-show="Object.keys(filteredProviders).length === 0" class="text-center py-8">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">
                        没有找到匹配的服务商
                    </h3>
                    <p class="mt-1 text-sm text-gray-500">
                        尝试调整搜索条件或筛选器
                    </p>
                </div>
            </div>

            <!-- 分页控制 -->
            <div x-show="totalProviderPages > 1" class="mt-6 flex items-center justify-between">
                <div class="text-sm text-gray-700">
                    显示 <span x-text="providerPageOffset + 1"></span>-<span
                        x-text="Math.min(providerPageOffset + providersPerPage, Object.keys(filteredProviders).length)"></span>
                    共
                    <span x-text="Object.keys(filteredProviders).length"></span>
                    个分组
                </div>
                <div class="flex space-x-1">
                    <button @click="providerPage = Math.max(1, providerPage - 1)" :disabled="providerPage <= 1"
                        class="px-3 py-2 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                        上一页
                    </button>
                    <span class="px-3 py-2 text-sm border-t border-b"
                        x-text="providerPage + ' / ' + totalProviderPages"></span>
                    <button @click="providerPage = Math.min(totalProviderPages, providerPage + 1)"
                        :disabled="providerPage >= totalProviderPages"
                        class="px-3 py-2 text-sm border rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
                        下一页
                    </button>
                </div>
            </div>
        </div>

        <!-- Provider Models -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold">支持的模型</h2>
                <div class="flex space-x-2">
                    <select x-model="selectedProvider" @change="loadProviderModels()"
                        class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">所有服务商</option>
                        <template x-for="(provider, groupId) in providerStatuses" :key="groupId">
                            <option :value="groupId" x-text="provider.group_name"></option>
                        </template>
                    </select>
                    <button @click="loadProviderModels()"
                        :disabled="loadingModels"
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-200 disabled:opacity-50">
                        <span x-show="!loadingModels">加载模型</span>
                        <span x-show="loadingModels">加载中...</span>
                    </button>
                </div>
            </div>

            <div x-show="loadingModels" class="text-center py-8">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
                <p class="mt-2 text-gray-600">加载模型中...</p>
            </div>

            <div x-show="!loadingModels && Object.keys(providerModels).length > 0" class="space-y-4">
                <template x-for="(models, groupId) in providerModels" :key="groupId">
                    <div class="border rounded-lg p-4">
                        <h3 class="font-semibold text-gray-900 mb-3"
                            x-text="models.group_name + ' (' + models.provider_type + ')'"></h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2">
                            <template x-for="model in (models.models && models.models.data ? models.models.data : [])"
                                :key="model.id">
                                <div class="bg-gray-100 px-3 py-2 rounded text-sm">
                                    <span class="font-mono" x-text="model.id"></span>
                                    <span x-show="model.alias_name" class="text-gray-500 ml-2"
                                        x-text="'(别名: ' + model.alias_name + ')'"></span>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>

            <div x-show="!loadingModels && Object.keys(providerModels).length === 0"
                class="text-center py-8 text-gray-500">
                <p>暂无模型数据，请选择服务商并点击加载模型</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-6">快速操作</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button @click="showProxyKeyModal = true; loadProxyKeys()"
                    class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    代理密钥管理
                </button>
                <button @click="exportHealthReport()"
                    class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    导出健康报告
                </button>
                <button @click="viewSystemLogs()"
                    class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition duration-200">
                    查看请求日志
                </button>
            </div>
            <div class="mt-4 text-sm text-gray-500">
                最后更新: <span x-text="formatDate(lastUpdate)"></span>
            </div>
        </div>

        <!-- Group Management Modal -->
        <div x-show="showCreateGroupModal || showEditGroupModal" x-cloak
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
            style="display: none;">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col" @click.stop>
                <!-- 头部 -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900"
                                x-text="showCreateGroupModal ? '添加服务商分组' : '编辑服务商分组'"></h3>
                            <p class="text-sm text-gray-500"
                                x-text="showCreateGroupModal ? '配置新的API服务商分组' : '修改现有服务商分组配置'"></p>
                        </div>
                    </div>
                    <button @click="closeGroupModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- 内容区域 -->
                <div class="flex-1 overflow-y-auto p-6">
                    <form id="groupForm" @submit.prevent="submitGroupForm()" class="space-y-8">
                        <!-- 基本信息区域 -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div class="flex items-center space-x-2 mb-4">
                                <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h4 class="text-lg font-semibold text-gray-900">
                                    基本信息
                                </h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">分组ID *</label>
                                    <input type="text" x-model="groupFormData.group_id" :disabled="showEditGroupModal"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required placeholder="如: openai-group" />
                                    <p class="text-xs text-gray-500 mt-1">
                                        唯一标识符，创建后不可修改
                                    </p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">分组名称 *</label>
                                    <input type="text" x-model="groupFormData.name"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required placeholder="如: OpenAI 官方" />
                                    <p class="text-xs text-gray-500 mt-1">
                                        用于显示的友好名称
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- 服务商配置区域 -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div class="flex items-center space-x-2 mb-4">
                                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <h4 class="text-lg font-semibold text-gray-900">
                                    服务商配置
                                </h4>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">服务商类型 *</label>
                                    <select x-model="groupFormData.provider_type" @change="onProviderTypeChange()"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required>
                                        <option value="">
                                            请选择服务商类型
                                        </option>
                                        <option value="openai">
                                            OpenAI
                                        </option>
                                        <option value="openai_responses">
                                            OpenAI Responses
                                        </option>
                                        <option value="gemini">
                                            Google Gemini
                                        </option>
                                        <option value="anthropic">
                                            Anthropic
                                        </option>
                                        <!-- <option value="azure_openai">
                                                Azure OpenAI
                                            </option>
                                            <option value="openrouter">
                                                OpenRouter
                                            </option> -->
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">
                                        选择API服务商类型
                                    </p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Base URL *</label>
                                    <input type="url" x-model="groupFormData.base_url"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        required placeholder="如: https://api.openai.com/v1" />
                                    <p class="text-xs text-gray-500 mt-1">
                                        API服务的基础URL地址
                                    </p>
                                </div>

                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">启用状态</label>
                                    <div class="flex flex-col sm:flex-row sm:space-x-6 space-y-4 sm:space-y-0">
                                        <!-- 启用此分组开关组合单元 -->
                                        <div class="flex-1 space-y-2">
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="groupFormData.enabled"
                                                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                                                <span class="text-sm text-gray-700">启用此分组</span>
                                            </label>
                                            <p class="text-xs text-gray-500">
                                                禁用分组后将不会处理请求
                                            </p>
                                        </div>

                                        <!-- 启用健康检查开关组合单元 -->
                                        <div class="flex-1 space-y-2">
                                            <label class="flex items-center space-x-2 cursor-pointer">
                                                <input type="checkbox" x-model="groupFormData.health_check_enabled"
                                                    class="w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500" />
                                                <span class="text-sm text-gray-700">启用健康检查</span>
                                            </label>
                                            <p class="text-xs text-gray-500">
                                                禁用健康检查后该分组不会被定时检查服务检测
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 配置参数区域 -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div class="flex items-center space-x-2 mb-6">
                                <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4">
                                    </path>
                                </svg>
                                <h4 class="text-lg font-semibold text-gray-900">
                                    配置参数
                                </h4>
                            </div>
                            <!-- 基础配置 -->
                            <div class="mb-6">
                                <h5 class="text-sm font-medium text-gray-800 mb-4 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                                        </path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    基础配置
                                </h5>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            <svg class="w-4 h-4 inline mr-1 text-orange-500" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                            超时时间（秒）
                                        </label>
                                        <input type="number" x-model="groupFormData.timeout"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            min="1" max="600" placeholder="30" />
                                        <p class="text-xs text-gray-500 mt-2">
                                            请求超时时间，建议30-120秒
                                        </p>
                                    </div>

                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            <svg class="w-4 h-4 inline mr-1 text-red-500" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                                </path>
                                            </svg>
                                            最大重试次数
                                        </label>
                                        <input type="number" x-model="groupFormData.max_retries"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            min="0" max="10" placeholder="3" />
                                        <p class="text-xs text-gray-500 mt-2">
                                            失败后的重试次数，建议1-5次
                                        </p>
                                    </div>

                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            <svg class="w-4 h-4 inline mr-1 text-green-500" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                                </path>
                                            </svg>
                                            轮换策略
                                        </label>
                                        <select x-model="groupFormData.rotation_strategy"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                            <option value="round_robin">
                                                轮询 (Round Robin)
                                            </option>
                                            <option value="random">
                                                随机 (Random)
                                            </option>
                                            <option value="least_used">
                                                最少使用 (Least Used)
                                            </option>
                                        </select>
                                        <p class="text-xs text-gray-500 mt-2">
                                            多个密钥时的选择策略
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- RPM限制配置和测试模型配置 -->
                            <div class="mb-6">
                                <h5 class="text-sm font-medium text-gray-800 mb-4 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                    高级配置
                                </h5>
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">RPM限制</label>
                                        <input type="number" x-model="groupFormData.rpm_limit" min="0"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="0" />
                                        <p class="text-xs text-gray-500 mt-2">
                                            每分钟请求数限制，0表示无限制
                                        </p>
                                    </div>

                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">测试模型（用于密钥检测）</label>
                                        <input type="text" x-model="groupFormData.test_model"
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="例如：gpt-3.5-turbo 或 gemini-1.5-flash" />
                                        <p class="text-xs text-gray-500 mt-2">
                                            用于验证API密钥可用性的模型ID，留空则按分组模型或默认模型验证
                                        </p>
                                    </div>

                                    <!-- 假流配置 -->
                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">假流模式（实验性功能）</label>
                                        <label class="flex items-center space-x-3 mt-2">
                                            <input type="checkbox" x-model="groupFormData.fake_streaming"
                                                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                            <span class="text-sm text-gray-700">
                                                启用假流模式
                                            </span>
                                        </label>
                                        <p class="text-xs text-gray-500 mt-2">
                                            将非流式响应伪装成流式响应输出给客户端
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <!-- 代理配置 -->
                            <div class="mb-6">
                                <h5 class="text-sm font-medium text-gray-800 mb-4 flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0">
                                        </path>
                                    </svg>
                                    代理配置
                                </h5>
                                <div class="space-y-4">
                                    <!-- 启用代理开关 -->
                                    <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                        <label class="flex items-center space-x-3">
                                            <input type="checkbox" x-model="groupFormData.proxy_enabled"
                                                class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                            <span class="text-sm font-medium text-gray-700">
                                                启用代理
                                            </span>
                                        </label>
                                        <p class="text-xs text-gray-500 mt-2">
                                            启用后，该分组的所有API请求将通过配置的代理服务器发送
                                        </p>
                                    </div>

                                    <!-- 代理设置（仅在启用代理时显示） -->
                                    <div x-show="groupFormData.proxy_enabled" class="space-y-4">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                                    代理类型
                                                </label>
                                                <select x-model="groupFormData.proxy_config.type"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                                    <option value="http">HTTP</option>
                                                    <option value="https">HTTPS</option>
                                                    <option value="socks5">SOCKS5</option>
                                                </select>
                                            </div>

                                            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                                    代理主机 *
                                                </label>
                                                <input type="text" x-model="groupFormData.proxy_config.host"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder="127.0.0.1 或 proxy.example.com" />
                                            </div>

                                            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                                    代理端口 *
                                                </label>
                                                <input type="number" x-model="groupFormData.proxy_config.port"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    min="1" max="65535" placeholder="8080" />
                                            </div>

                                            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                                    用户名（可选）
                                                </label>
                                                <input type="text" x-model="groupFormData.proxy_config.username"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder="代理认证用户名" />
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                                    密码（可选）
                                                </label>
                                                <input type="password" x-model="groupFormData.proxy_config.password"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    placeholder="代理认证密码" />
                                            </div>

                                            <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                                <label class="flex items-center space-x-3">
                                                    <input type="checkbox"
                                                        x-model="groupFormData.proxy_config.bypass_local"
                                                        class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                                    <span class="text-sm font-medium text-gray-700">
                                                        绕过本地地址
                                                    </span>
                                                </label>
                                                <p class="text-xs text-gray-500 mt-2">
                                                    本地地址（127.0.0.1, localhost等）不使用代理
                                                </p>
                                            </div>
                                        </div>

                                        <div class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm">
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                绕过域名列表（可选）
                                            </label>
                                            <textarea x-model="groupFormData.proxy_bypass_domains_text" rows="3"
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="每行一个域名，例如：&#10;example.com&#10;*.internal.com&#10;192.168.*"></textarea>
                                            <p class="text-xs text-gray-500 mt-2">
                                                这些域名的请求不会通过代理，支持通配符（*）
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 高级选项 -->
                            <!-- <div>
                                    <h5
                                        class="text-sm font-medium text-gray-800 mb-4 flex items-center"
                                    >
                                        <svg
                                            class="w-4 h-4 mr-2 text-purple-500"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                                            ></path>
                                            <path
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                                            ></path>
                                        </svg>
                                        高级选项
                                    </h5>
                                    <div
                                        class="bg-white rounded-lg p-4 border border-gray-200 shadow-sm"
                                    >
                                        <label
                                            class="flex items-start space-x-3 cursor-pointer"
                                        >
                                            <input
                                                type="checkbox"
                                                x-model="groupFormData.use_native_response"
                                                class="mt-1 rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50"
                                            />
                                            <div>
                                                <span
                                                    class="text-sm font-medium text-gray-700"
                                                    >使用原生接口响应</span
                                                >
                                                <p
                                                    class="text-xs text-gray-500 mt-1"
                                                >
                                                    勾选后将返回服务商的原生响应格式，而不是OpenAI兼容格式
                                                </p>
                                            </div>
                                        </label>
                                    </div>
                                </div> -->
                        </div>

                        <!-- API密钥区域 -->
                        <div class="bg-gray-50 rounded-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2m0 0V7a2 2 0 012-2h4zm-6 2v6h4V9H9z">
                                        </path>
                                    </svg>
                                    <h4 class="text-lg font-semibold text-gray-900">
                                        API密钥管理
                                    </h4>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button type="button" @click="showBatchAddModal = true"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        批量添加
                                    </button>
                                    <button type="button" @click="addGroupApiKey()"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                        添加密钥
                                    </button>
                                    <button type="button" @click="clearAllKeys()"
                                        :disabled="groupFormData.api_keys.filter(k => k.trim()).length === 0"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                        清空密钥
                                    </button>
                                    <button type="button" @click="exportKeys()"
                                        :disabled="groupFormData.api_keys.filter(k => k.trim()).length === 0"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                            </path>
                                        </svg>
                                        导出密钥
                                    </button>
                                    <button type="button" @click="deleteInvalidKeys()" x-show="getInvalidKeyCount() > 0"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                        删除失效密钥 (<span x-text="getInvalidKeyCount()"></span>)
                                    </button>
                                    <button type="button" @click="bulkDeleteInvalidKeysFromServer()"
                                        x-show="showEditGroupModal && editingGroupId"
                                        :disabled="bulkDeletingInvalidKeys"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                        <svg x-show="!bulkDeletingInvalidKeys" class="w-4 h-4 mr-1" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                        <svg x-show="bulkDeletingInvalidKeys" class="animate-spin w-4 h-4 mr-1"
                                            fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor"
                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                            </path>
                                        </svg>
                                        <span x-show="!bulkDeletingInvalidKeys">一键删除失效密钥</span>
                                        <span x-show="bulkDeletingInvalidKeys">删除中...</span>
                                    </button>
                                    <button type="button" @click="deleteSelectedKeys()" x-show="selectedKeys.length > 0"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                            </path>
                                        </svg>
                                        删除选中 (<span x-text="selectedKeys.length"></span>)
                                    </button>
                                    <button type="button" @click="removeDuplicateKeys()"
                                        x-show="checkCurrentKeyDuplicates().size > 0"
                                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        去除重复
                                    </button>
                                </div>
                            </div>

                            <!-- 密钥列表 -->
                            <div class="border rounded-md max-h-60 overflow-y-auto">
                                <div class="space-y-1 p-2">
                                    <template x-for="(key, index) in paginatedKeys" :key="index + keyPageOffset">
                                        <div class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded"
                                            :class="getKeyValidationClass(index + keyPageOffset) + (checkCurrentKeyDuplicates().has(index + keyPageOffset) ? ' border-l-4 border-orange-400 bg-orange-50' : '')">
                                            <input type="checkbox" :value="index + keyPageOffset" x-model="selectedKeys"
                                                class="rounded" />
                                            <div class="flex-1 relative">
                                                <input type="text"
                                                    x-model="groupFormData.api_keys[index + keyPageOffset]"
                                                    class="w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500"
                                                    placeholder="输入API密钥" />
                                                <!-- 验证状态指示器 -->
                                                <div
                                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center space-x-1">
                                                    <!-- 有效状态 -->
                                                    <div x-show="keyValidationStatus[index + keyPageOffset] === 'valid'"
                                                        class="flex items-center" title="密钥有效">
                                                        <svg class="w-4 h-4 text-green-500" fill="currentColor"
                                                            viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd"
                                                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                                clip-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                    <!-- 无效状态 -->
                                                    <div x-show="keyValidationStatus[index + keyPageOffset] === 'invalid'"
                                                        class="flex items-center" title="密钥无效">
                                                        <svg class="w-4 h-4 text-red-500" fill="currentColor"
                                                            viewBox="0 0 20 20">
                                                            <path fill-rule="evenodd"
                                                                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                                clip-rule="evenodd"></path>
                                                        </svg>
                                                    </div>
                                                    <!-- 验证中状态 -->
                                                    <div x-show="keyValidationStatus[index + keyPageOffset] === 'validating'"
                                                        class="flex items-center" title="验证中">
                                                        <svg class="w-4 h-4 text-yellow-500 animate-spin" fill="none"
                                                            viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10"
                                                                stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor"
                                                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                                            </path>
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- 强制设置密钥状态按钮 -->
                                            <div class="flex items-center space-x-1">
                                                <button type="button"
                                                    @click="forceSetKeyStatus(index + keyPageOffset, 'valid')"
                                                    :disabled="forcingKeyStatus[index + keyPageOffset]"
                                                    class="text-green-600 hover:text-green-800 p-1 rounded"
                                                    title="强制设为有效"
                                                    x-show="keyValidationStatus[index + keyPageOffset] !== 'valid'">
                                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd"
                                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                            clip-rule="evenodd"></path>
                                                    </svg>
                                                </button>
                                                <button type="button"
                                                    @click="forceSetKeyStatus(index + keyPageOffset, 'invalid')"
                                                    :disabled="forcingKeyStatus[index + keyPageOffset]"
                                                    class="text-red-600 hover:text-red-800 p-1 rounded" title="强制设为无效"
                                                    x-show="keyValidationStatus[index + keyPageOffset] !== 'invalid'">
                                                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd"
                                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                                            clip-rule="evenodd"></path>
                                                    </svg>
                                                </button>
                                            </div>
                                            <button type="button" @click="removeGroupApiKey(index + keyPageOffset)"
                                                class="text-red-500 hover:text-red-700 p-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </template>
                                </div>

                                <!-- 分页控制 -->
                                <div x-show="groupFormData.api_keys.length > keysPerPage"
                                    class="border-t p-2 flex justify-between items-center bg-gray-50">
                                    <div class="text-sm text-gray-600">
                                        显示
                                        <span x-text="keyPageOffset + 1"></span>-<span
                                            x-text="Math.min(keyPageOffset + keysPerPage, groupFormData.api_keys.length)"></span>
                                        共
                                        <span x-text="groupFormData.api_keys.length"></span>
                                        个密钥
                                    </div>
                                    <div class="flex space-x-1">
                                        <button type="button" @click="keyPage = Math.max(1, keyPage - 1)"
                                            :disabled="keyPage <= 1"
                                            class="px-2 py-1 text-sm border rounded disabled:opacity-50">
                                            上一页
                                        </button>
                                        <button type="button" @click="keyPage = Math.min(totalKeyPages, keyPage + 1)"
                                            :disabled="keyPage >= totalKeyPages"
                                            class="px-2 py-1 text-sm border rounded disabled:opacity-50">
                                            下一页
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 支持的模型 -->
                        <div class="md:col-span-2 mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold">
                                    支持的模型（可选）
                                </h4>
                                <div class="flex space-x-2">
                                    <button type="button" @click="loadAvailableModels()"
                                        :disabled="loadingModels || !groupFormData.provider_type || !groupFormData.base_url || groupFormData.api_keys.filter(k => k.trim()).length === 0"
                                        class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50">
                                        <span x-show="!loadingModels">加载模型</span>
                                        <span x-show="loadingModels">加载中...</span>
                                    </button>
                                    <button type="button" @click="loadAvailableModelsAndAutoSelect()"
                                        :disabled="loadingModels || !groupFormData.provider_type || !groupFormData.base_url || groupFormData.api_keys.filter(k => k.trim()).length === 0"
                                        class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm disabled:opacity-50">
                                        <span x-show="!loadingModels">加载模型并自动选择</span>
                                        <span x-show="loadingModels">加载中...</span>
                                    </button>
                                    <button type="button" @click="selectAllModels()" x-show="availableModels.length > 0"
                                        class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm">
                                        全选
                                    </button>
                                    <button type="button" @click="clearAllModels()"
                                        x-show="groupFormData.models.length > 0"
                                        class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm">
                                        清空
                                    </button>
                                </div>
                            </div>

                            <!-- 模型选择器 -->
                            <div x-show="availableModels.length > 0" class="border rounded-md p-3 bg-gray-50 mb-3">
                                <div class="flex justify-between items-center mb-2">
                                    <div class="text-sm text-gray-600">
                                        从API加载的可用模型：
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        显示
                                        <span x-text="filteredModels.length"></span>
                                        /
                                        <span x-text="availableModels.length"></span>
                                        个模型
                                    </div>
                                </div>

                                <!-- 搜索框 -->
                                <div class="mb-3">
                                    <div class="relative">
                                        <input type="text" x-model="modelSearchQuery" @input="filterModels()"
                                            placeholder="搜索模型名称..."
                                            class="w-full px-3 py-2 pl-8 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" />
                                        <svg class="absolute left-2 top-2.5 h-4 w-4 text-gray-400" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                        </svg>
                                        <button x-show="modelSearchQuery" @click="clearModelSearch()"
                                            class="absolute right-2 top-2 text-gray-400 hover:text-gray-600">
                                            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <!-- 模型列表 -->
                                <div class="max-h-40 overflow-y-auto space-y-1">
                                    <template x-for="model in filteredModels" :key="model.id">
                                        <label class="flex items-center space-x-2 text-sm hover:bg-white p-1 rounded">
                                            <input type="checkbox" :value="model.id" x-model="groupFormData.models"
                                                @change="syncModelsToText" class="rounded" />
                                            <span class="font-mono" x-text="model.id"></span>
                                            <span x-show="model.owned_by" class="text-gray-500"
                                                x-text="'(' + model.owned_by + ')'"></span>
                                        </label>
                                    </template>
                                    <div x-show="filteredModels.length === 0 && modelSearchQuery"
                                        class="text-center py-4 text-gray-500 text-sm">
                                        未找到匹配的模型
                                    </div>
                                </div>
                            </div>

                            <!-- 手动输入模型 -->
                            <div>
                                <div class="text-sm text-gray-600 mb-2">
                                    或手动输入模型名称：
                                </div>
                                <textarea x-model="modelsText" @input="syncTextToModels"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="3" placeholder="每行一个模型名称，留空表示支持所有模型"></textarea>
                                <p class="text-sm text-gray-500 mt-1">
                                    每行输入一个模型名称，如：gpt-3.5-turbo
                                </p>
                            </div>

                            <!-- 已选择的模型预览 -->
                            <div x-show="groupFormData.models.length > 0" class="mt-3">
                                <div class="text-sm text-gray-600 mb-2">
                                    已选择的模型 (<span x-text="groupFormData.models.length"></span>)：
                                </div>
                                <div class="flex flex-wrap gap-1">
                                    <template x-for="model in groupFormData.models" :key="model">
                                        <span
                                            class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                                            <span x-text="model"></span>
                                            <button type="button" @click="removeModel(model)"
                                                class="ml-1 text-blue-600 hover:text-blue-800">
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                </svg>
                                            </button>
                                        </span>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- 模型重命名配置 -->
                        <div class="md:col-span-2 mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold">
                                    模型重命名配置（可选）
                                </h4>
                                <div class="flex items-center space-x-2">
                                    <button type="button" @click="showPasteModelMappingModal = true"
                                        class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors">
                                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2">
                                            </path>
                                        </svg>
                                        批量粘贴
                                    </button>
                                    <button type="button" @click="showModelMappingHelp = !showModelMappingHelp"
                                        class="text-gray-400 hover:text-gray-600">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                            </path>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- 帮助信息 -->
                            <div x-show="showModelMappingHelp" x-collapse
                                class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-700">
                                <p class="mb-2">
                                    <strong>模型重命名功能说明：</strong>
                                </p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>
                                        可以为该分组的模型设置别名，统一不同分组的模型名称
                                    </li>
                                    <li>
                                        客户端使用别名请求时，系统会自动转换为实际的模型名称
                                    </li>
                                    <li>
                                        例如：将"gpt-4-turbo"重命名为"gpt-4"，客户端可以统一使用"gpt-4"
                                    </li>
                                    <li>
                                        支持多个别名映射到同一个实际模型
                                    </li>
                                    <li class="text-blue-600">
                                        <strong>跨分组映射：</strong>不同分组可以使用相同的别名，系统会自动选择可用的分组
                                    </li>
                                    <li class="text-orange-600">
                                        <strong>同分组限制：</strong>同一分组内，一个别名只能映射到一个模型
                                    </li>
                                </ul>
                            </div>

                            <!-- 模型映射列表 -->
                            <div class="space-y-2">
                                <template x-for="(mapping, index) in modelMappings" :key="index">
                                    <div class="flex items-center space-x-2 p-2 border border-gray-200 rounded-md">
                                        <div class="flex-1">
                                            <label class="block text-xs text-gray-500 mb-1">别名（客户端使用）</label>
                                            <div class="relative"
                                                x-data="{ showAliasDropdown: false, filteredAliases: [] }" x-init="
                                                    filteredAliases = [...(allConfiguredAliases || [])].sort();
                                                    $watch('mapping.alias', value => {
                                                        if (value) {
                                                            filteredAliases = [...(allConfiguredAliases || [])].filter(a => a.toLowerCase().includes(value.toLowerCase())).sort();
                                                        } else {
                                                            filteredAliases = [...(allConfiguredAliases || [])].sort();
                                                        }
                                                    });
                                                ">
                                                <input type="text" x-model="mapping.alias"
                                                    @input="showAliasDropdown = true" @focus="showAliasDropdown = true"
                                                    @blur="setTimeout(() => showAliasDropdown = false, 200)"
                                                    :class="getDuplicateAliasClass(mapping.alias, index)"
                                                    placeholder="输入或选择别名，例如: gpt-4" autocomplete="off">
                                                <button type="button" @click="showAliasDropdown = !showAliasDropdown"
                                                    class="absolute right-1 top-1 p-1 text-gray-400 hover:text-gray-600">
                                                    <svg class="w-3 h-3" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                                    </svg>
                                                </button>
                                                <div x-show="showAliasDropdown && filteredAliases.length > 0" x-cloak
                                                    class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto">
                                                    <template x-for="alias in filteredAliases.slice(0, 50)"
                                                        :key="alias">
                                                        <div @click="mapping.alias = alias; showAliasDropdown = false"
                                                            class="px-3 py-2 text-sm cursor-pointer hover:bg-blue-50 hover:text-blue-600"
                                                            :class="{ 'bg-blue-100 text-blue-600': mapping.alias === alias }"
                                                            x-text="alias"></div>
                                                    </template>
                                                    <div x-show="filteredAliases.length > 50"
                                                        class="px-3 py-2 text-xs text-gray-500 border-t">
                                                        显示前50个结果，输入更多字符以缩小范围
                                                    </div>
                                                </div>
                                            </div>
                                            <div x-show="isDuplicateAlias(mapping.alias, index)"
                                                class="text-xs text-orange-600 mt-1">
                                                ⚠️ 此别名在当前分组中已存在
                                            </div>
                                        </div>
                                        <div class="text-gray-400 flex items-center justify-center mt-6">→</div>
                                        <div class="flex-1">
                                            <label class="block text-xs text-gray-500 mb-1">实际模型名称</label>
                                            <select x-model="mapping.original"
                                                @change="suggestAliasFromSimilarity(mapping)"
                                                class="w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500">
                                                <option value="">
                                                    请选择模型
                                                </option>
                                                <template x-for="model in groupFormData.models" :key="model">
                                                    <option :value="model" :selected="model === mapping.original"
                                                        x-text="model"></option>
                                                </template>
                                            </select>
                                        </div>
                                        <button type="button" @click="removeModelMapping(index)"
                                            class="text-red-500 hover:text-red-700 p-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                                </path>
                                            </svg>
                                        </button>
                                    </div>
                                </template>

                                <!-- 添加新映射按钮 -->
                                <button type="button" @click="addModelMapping()"
                                    class="w-full py-2 px-4 border-2 border-dashed border-gray-300 rounded-md text-gray-500 hover:border-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4"></path>
                                    </svg>
                                    添加模型重命名
                                </button>
                            </div>
                        </div>

                        <!-- JSON请求参数覆盖 -->
                        <div class="md:col-span-2 mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold">
                                    JSON请求参数覆盖（可选）
                                </h4>
                                <button type="button" @click="showRequestParamsHelp = !showRequestParamsHelp"
                                    class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                        </path>
                                    </svg>
                                </button>
                            </div>

                            <!-- 帮助信息 -->
                            <div x-show="showRequestParamsHelp" x-collapse
                                class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-700">
                                <p class="mb-2">
                                    <strong>JSON请求参数覆盖功能说明：</strong>
                                </p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>
                                        可以为该分组设置默认的请求参数，这些参数会覆盖客户端发送的参数
                                    </li>
                                    <li>
                                        支持的参数：temperature（温度）、max_tokens（最大token数）、top_p、stop（停止词）
                                    </li>
                                    <li>
                                        示例：{"temperature": 0.7,
                                        "max_tokens": 1000, "top_p": 0.9}
                                    </li>
                                    <li>
                                        留空表示不覆盖任何参数，使用客户端发送的原始参数
                                    </li>
                                </ul>
                            </div>

                            <!-- JSON编辑器 -->
                            <div>
                                <textarea x-model="requestParamsText" @input="validateRequestParams()"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                                    rows="6"
                                    placeholder='{"temperature": 0.7, "max_tokens": 1000, "top_p": 0.9, "stop": ["Human:", "AI:"]}'></textarea>
                                <p class="text-sm text-gray-500 mt-1">
                                    请输入有效的JSON格式，留空表示不覆盖任何参数
                                </p>
                            </div>

                            <!-- JSON验证状态 -->
                            <div x-show="requestParamsValidationMessage" class="mt-2">
                                <div :class="requestParamsValidationError ? 'text-red-600' : 'text-green-600'"
                                    class="text-sm flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path x-show="requestParamsValidationError" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        <path x-show="!requestParamsValidationError" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span x-text="requestParamsValidationMessage"></span>
                                </div>
                            </div>
                        </div>

                        <!-- JSON请求头覆盖 -->
                        <div class="md:col-span-2 mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <h4 class="font-semibold">
                                    JSON请求头覆盖（可选）
                                </h4>
                                <button type="button" @click="showHeadersHelp = !showHeadersHelp"
                                    class="text-gray-400 hover:text-gray-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                            <!-- 帮助信息 -->
                            <div x-show="showHeadersHelp" x-collapse
                                class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-700">
                                <p class="mb-2">
                                    <strong>JSON请求头覆盖功能说明：</strong>
                                </p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>
                                        可以为该分组设置额外的请求头，这些请求头会添加到API请求中
                                    </li>
                                    <li>
                                        支持自定义请求头：User-Agent、Referer、X-Custom-Header等
                                    </li>
                                    <li>
                                        示例：{"User-Agent": "MyApp/1.0", "X-Custom-Header": "custom-value"}
                                    </li>
                                    <li>
                                        留空表示不添加任何自定义请求头
                                    </li>
                                </ul>
                            </div>
                            <!-- JSON编辑器 -->
                            <div>
                                <textarea x-model="headersText" @input="validateHeaders()"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                                    rows="6"
                                    placeholder='{"User-Agent": "MyApp/1.0", "X-Custom-Header": "custom-value", "Referer": "https://example.com"}'></textarea>
                                <p class="text-sm text-gray-500 mt-1">
                                    请输入有效的JSON格式，留空表示不添加任何自定义请求头
                                </p>
                            </div>
                            <!-- JSON验证状态 -->
                            <div x-show="headersValidationMessage" class="mt-2">
                                <div :class="headersValidationError ? 'text-red-600' : 'text-green-600'"
                                    class="text-sm flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path x-show="headersValidationError" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2"
                                            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        <path x-show="!headersValidationError" stroke-linecap="round"
                                            stroke-linejoin="round" stroke-width="2"
                                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span x-text="headersValidationMessage"></span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- 底部操作 -->
                <div class="border-t border-gray-200 px-6 py-4 bg-gray-50 rounded-b-lg">
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-gray-500">
                            <span x-show="showCreateGroupModal">填写完整信息后点击创建</span>
                            <span x-show="showEditGroupModal">修改完成后点击更新保存</span>
                        </div>
                        <div class="flex space-x-3">
                            <button type="button" @click="closeGroupModal()"
                                class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                取消
                            </button>
                            <button type="submit" form="groupForm" :disabled="submittingGroup"
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                                <svg x-show="submittingGroup" class="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
                                    fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                                <span x-show="!submittingGroup" x-text="showCreateGroupModal ? '创建分组' : '更新分组'"></span>
                                <span x-show="submittingGroup">处理中...</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Paste Model Mapping Modal -->
        <div x-show="showPasteModelMappingModal" x-cloak x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-2xl">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">批量粘贴模型重命名配置</h3>
                    <button @click="closePasteModelMappingModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        JSON格式的模型映射配置
                    </label>
                    <div class="mb-2 p-3 bg-blue-50 border border-blue-200 rounded-md text-sm text-blue-700">
                        <p class="mb-2"><strong>格式说明：</strong></p>
                        <ul class="list-disc list-inside space-y-1">
                            <li>JSON对象格式，key为新名字（别名），value为原始名字</li>
                            <li>例如：<code>{"gemini-2.5-flash-image-preview": "google/gemini-2.5-flash-image-preview:free"}</code>
                            </li>
                            <li>系统将自动解析并添加到当前分组的模型重命名列表中</li>
                        </ul>
                    </div>
                    <textarea x-model="pasteModelMappingText" @input="validatePasteModelMapping()"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                        rows="10" placeholder='{
  "gemini-2.5-flash-image-preview": "google/gemini-2.5-flash-image-preview:free",
  "deepseek-chat-v3.1": "deepseek/deepseek-chat-v3.1:free",
  "qwen3-coder": "qwen/qwen3-coder:free",
  "kimi-vl-a3b-thinking": "moonshotai/kimi-vl-a3b-thinking:free"
}'></textarea>

                    <!-- 验证状态 -->
                    <div x-show="pasteModelMappingValidationMessage" class="mt-2">
                        <div :class="pasteModelMappingValidationError ? 'text-red-600' : 'text-green-600'"
                            class="text-sm flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path x-show="pasteModelMappingValidationError" stroke-linecap="round"
                                    stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                <path x-show="!pasteModelMappingValidationError" stroke-linecap="round"
                                    stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span x-text="pasteModelMappingValidationMessage"></span>
                        </div>
                    </div>
                </div>

                <div class="flex justify-end space-x-3">
                    <button type="button" @click="closePasteModelMappingModal()"
                        class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        取消
                    </button>
                    <button type="button" @click="applyPasteModelMapping()"
                        :disabled="pasteModelMappingValidationError || !pasteModelMappingText.trim()"
                        class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
                        确定
                    </button>
                </div>
            </div>
        </div>

        <!-- Batch Add Keys Modal -->
        <div x-show="showBatchAddModal" x-cloak x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white rounded-lg p-6 w-full max-w-lg">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">批量添加API密钥</h3>
                    <button @click="showBatchAddModal = false" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">API密钥列表</label>
                    <textarea x-model="batchKeysText"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        rows="8"
                        placeholder="每行输入一个API密钥&#10;支持以下格式：&#10;sk-1234567890abcdef&#10;your-api-key-here&#10;&#10;空行将被忽略"></textarea>
                    <p class="text-sm text-gray-500 mt-1">
                        每行输入一个API密钥，空行将被自动忽略
                    </p>
                </div>

                <div class="flex justify-end space-x-4">
                    <button type="button" @click="showBatchAddModal = false"
                        class="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                        取消
                    </button>
                    <button type="button" @click="addBatchKeys()"
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md">
                        添加密钥
                    </button>
                </div>
            </div>
        </div>

        <!-- Import Groups Modal -->
        <div x-show="showImportModal" x-cloak
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">
                        导入分组配置
                    </h3>
                </div>

                <div class="px-6 py-4">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            选择配置文件 (JSON格式)
                        </label>
                        <input type="file" accept=".json" @change="handleFileSelect"
                            class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100" />
                    </div>

                    <div class="text-sm text-gray-600">
                        <p class="mb-2">注意事项：</p>
                        <ul class="list-disc list-inside space-y-1 text-xs">
                            <li>仅支持JSON格式的配置文件</li>
                            <li>导入的分组将覆盖同名的现有分组</li>
                            <li>请确保配置文件格式正确</li>
                        </ul>
                    </div>
                </div>

                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button @click="showImportModal = false"
                        class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition duration-200">
                        取消
                    </button>
                    <button @click="importGroups()" :disabled="!selectedFile || importing"
                        class="px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed rounded-md transition duration-200">
                        <span x-show="!importing">导入</span>
                        <span x-show="importing">导入中...</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Proxy Key Management Modal -->
        <div x-show="showProxyKeyModal" x-cloak
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-6xl max-h-[90vh] flex flex-col">
                <!-- 头部 -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2m0 0a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">
                                代理服务 API 密钥
                            </h3>
                            <p class="text-sm text-gray-500">
                                管理用于访问代理服务的API密钥
                            </p>
                        </div>
                    </div>
                    <button @click="showProxyKeyModal = false"
                        class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- 内容 -->
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- 操作栏 -->
                    <div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <!-- 生成新密钥按钮 -->
                        <button @click="showGenerateProxyKeyForm = true"
                            class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition duration-200">
                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4"></path>
                            </svg>
                            生成新密钥
                        </button>

                        <!-- 手动刷新按钮 - 图标样式 -->
                        <button @click="refreshProxyKeysOnly()"
                            class="bg-gray-100 hover:bg-gray-200 text-gray-600 hover:text-gray-800 p-2 rounded-lg transition duration-200"
                            title="手动刷新使用次数">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                </path>
                            </svg>
                        </button>

                        <!-- 搜索框、排序和页面大小选择 -->
                        <div class="flex flex-col sm:flex-row gap-2">
                            <!-- 搜索框 -->
                            <div class="relative">
                                <input type="text" x-model="proxyKeySearch" @input="searchProxyKeys()"
                                    @keyup.enter="searchProxyKeys()" placeholder="搜索密钥名称、描述或密钥..."
                                    class="w-full sm:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent" />
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                    </svg>
                                </div>
                                <button x-show="proxyKeySearch" @click="clearProxyKeySearch()"
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <svg class="h-4 w-4 text-gray-400 hover:text-gray-600" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- 排序选择 -->
                            <select x-model="proxyKeySortBy" @change="changeProxyKeySortBy()"
                                class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="created_time_desc">创建时间 ↓</option>
                                <option value="created_time_asc">创建时间 ↑</option>
                                <option value="usage_count_desc">使用次数 ↓</option>
                                <option value="usage_count_asc">使用次数 ↑</option>
                                <option value="name_asc">名称 A-Z</option>
                                <option value="name_desc">名称 Z-A</option>
                            </select>

                            <!-- 页面大小选择 -->
                            <select x-model="proxyKeyPageSize" @change="changeProxyKeyPageSize()"
                                class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="5">5条/页</option>
                                <option value="10">10条/页</option>
                                <option value="20">20条/页</option>
                                <option value="50">50条/页</option>
                            </select>
                        </div>
                    </div>

                    <!-- 生成密钥表单 -->
                    <div x-show="showGenerateProxyKeyForm" x-cloak
                        class="mb-6 p-6 bg-gray-50 rounded-lg border border-gray-200">
                        <h4 class="text-lg font-medium mb-6 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-indigo-600" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 7a2 2 0 012 2m0 0a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2m0 0V7a2 2 0 012-2h4zm-6 2v6h4V9H9z">
                                </path>
                            </svg>
                            生成新的代理密钥
                        </h4>

                        <!-- 基本信息 -->
                        <div class="mb-6">
                            <h5 class="text-sm font-medium text-gray-800 mb-3">
                                基本信息
                            </h5>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">密钥名称 *</label>
                                    <input type="text" x-model="newProxyKey.name" required
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        placeholder="输入密钥名称" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">描述</label>
                                    <input type="text" x-model="newProxyKey.description"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                        placeholder="输入描述信息" />
                                </div>
                            </div>
                        </div>

                        <!-- 分组权限 -->
                        <div class="mb-6">
                            <h5 class="text-sm font-medium text-gray-800 mb-3">
                                分组权限
                            </h5>
                            <div class="bg-white rounded-lg border border-gray-200 p-4">
                                <label class="block text-sm font-medium text-gray-700 mb-3">允许访问的分组</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-2 max-h-40 overflow-y-auto">
                                    <template x-for="(provider, groupId) in providerStatuses" :key="groupId">
                                        <label class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded">
                                            <input type="checkbox" :value="groupId"
                                                :checked="newProxyKey.allowed_groups.includes(groupId)"
                                                @change="toggleProxyKeyGroup(groupId, $event.target.checked)"
                                                class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" />
                                            <span class="text-sm" x-text="provider.group_name"></span>
                                        </label>
                                    </template>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">
                                    不选择任何分组表示可以访问所有分组
                                </p>
                            </div>
                        </div>

                        <!-- 分组间请求设置 -->
                        <div x-show="newProxyKey.allowed_groups.length > 1 || newProxyKey.allowed_groups.length === 0"
                            class="mb-6">
                            <h5 class="text-sm font-medium text-gray-800 mb-3 flex items-center">
                                <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 9l3 3-3 3m5 0h3"></path>
                                </svg>
                                分组间请求设置
                            </h5>
                            <div class="bg-white rounded-lg border border-gray-200 p-4">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">选择策略</label>
                                    <select x-model="newProxyKey.group_selection_config.strategy"
                                        @change="onNewProxyKeyStrategyChange()"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option value="round_robin">
                                            轮询 (Round Robin) -
                                            在分组间轮流分配请求
                                        </option>
                                        <option value="weighted">
                                            权重 (Weighted) -
                                            根据权重比例分配请求
                                        </option>
                                        <option value="random">
                                            随机 (Random) - 随机选择分组
                                        </option>
                                        <option value="failover">
                                            故障转移 (Failover) -
                                            按优先级顺序选择
                                        </option>
                                    </select>
                                </div>

                                <!-- 权重配置 -->
                                <div x-show="newProxyKey.group_selection_config.strategy === 'weighted'" class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-3">分组权重配置</label>
                                    <div class="space-y-2">
                                        <template
                                            x-for="groupId in getGroupsForWeightConfig(newProxyKey.allowed_groups)"
                                            :key="groupId">
                                            <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded">
                                                <span class="text-sm font-medium min-w-0 flex-1"
                                                    x-text="getGroupName(groupId)"></span>
                                                <div class="flex items-center space-x-2">
                                                    <label class="text-xs text-gray-600">权重:</label>
                                                    <input type="number" :value="getGroupWeight(groupId)"
                                                        @input="setGroupWeight(groupId, $event.target.value)" min="1"
                                                        max="100"
                                                        class="w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" />
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">
                                        权重越高，获得的请求越多。例如权重3:1的分组将获得约75%:25%的请求分配。
                                    </p>
                                </div>

                                <!-- 故障转移优先级配置 -->
                                <div x-show="newProxyKey.group_selection_config.strategy === 'failover'" class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-3">分组优先级配置</label>
                                    <div class="space-y-2">
                                        <template
                                            x-for="groupId in getGroupsForWeightConfig(newProxyKey.allowed_groups)"
                                            :key="groupId">
                                            <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded">
                                                <span class="text-sm font-medium min-w-0 flex-1"
                                                    x-text="getGroupName(groupId)"></span>
                                                <div class="flex items-center space-x-2">
                                                    <label class="text-xs text-gray-600">优先级:</label>
                                                    <input type="number" :value="getGroupWeight(groupId)"
                                                        @input="setGroupWeight(groupId, $event.target.value)" min="1"
                                                        max="10"
                                                        class="w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" />
                                                </div>
                                            </div>
                                        </template>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">
                                        数字越大优先级越高。优先使用优先级最高的分组，当该分组不可用时转移到下一优先级。
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-2">
                            <button @click="generateProxyKey()"
                                class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md flex items-center">
                                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                                生成密钥
                            </button>
                            <button @click="showGenerateProxyKeyForm = false; resetProxyKeyForm()"
                                class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md">
                                取消
                            </button>
                        </div>
                    </div>

                    <!-- 密钥列表 -->
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        密钥
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        名称/描述
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        分组配置
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        请求次数
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        创建时间
                                    </th>
                                    <th
                                        class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        操作
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="key in proxyKeys" :key="key.id">
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <code class="text-sm font-mono bg-gray-100 px-2 py-1 rounded"
                                                    x-text="key.key.substring(0, 20) + '...'"></code>
                                                <button @click="copyToClipboard(key.key)"
                                                    class="ml-2 text-gray-400 hover:text-gray-600">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                                                        </path>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="mt-1">
                                                <template x-if="key.allowed_groups && key.allowed_groups.length > 0">
                                                    <div class="flex flex-wrap gap-1">
                                                        <template x-for="groupId in key.allowed_groups" :key="groupId">
                                                            <span
                                                                class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800"
                                                                x-text="getGroupName(groupId)"></span>
                                                        </template>
                                                    </div>
                                                </template>
                                                <template x-if="!key.allowed_groups || key.allowed_groups.length === 0">
                                                    <span
                                                        class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">所有分组</span>
                                                </template>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900" x-text="key.name"></div>
                                            <div class="text-sm text-gray-500" x-text="key.description"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <!-- 分组选择配置显示 -->
                                            <template x-if="key.allowed_groups && key.allowed_groups.length > 1">
                                                <div class="text-sm">
                                                    <div class="flex items-center space-x-2 mb-1">
                                                        <span class="text-xs font-medium text-gray-600">策略:</span>
                                                        <span
                                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium"
                                                            :class="getStrategyBadgeClass(key.group_selection_config?.strategy || 'round_robin')"
                                                            x-text="getStrategyDisplayName(key.group_selection_config?.strategy || 'round_robin')"></span>
                                                    </div>
                                                    <template
                                                        x-if="key.group_selection_config?.strategy === 'weighted' && key.group_selection_config?.group_weights">
                                                        <div class="text-xs text-gray-500">
                                                            <template
                                                                x-for="weight in getSortedGroupWeights(key.group_selection_config.group_weights)"
                                                                :key="weight.group_id">
                                                                <div class="flex justify-between">
                                                                    <span x-text="getGroupName(weight.group_id)"></span>
                                                                    <span x-text="'权重: ' + weight.weight"></span>
                                                                </div>
                                                            </template>
                                                        </div>
                                                    </template>
                                                </div>
                                            </template>
                                            <template x-if="key.allowed_groups && key.allowed_groups.length === 1">
                                                <span class="text-xs text-gray-400">单分组</span>
                                            </template>
                                            <template x-if="!key.allowed_groups || key.allowed_groups.length === 0">
                                                <span class="text-xs text-gray-500">所有分组</span>
                                            </template>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"
                                            x-text="key.usage_count || 0"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                                            x-text="formatDate(key.created_at)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="editProxyKey(key)"
                                                class="text-indigo-600 hover:text-indigo-900 mr-3">
                                                编辑
                                            </button>
                                            <button @click="deleteProxyKey(key.id)"
                                                class="text-red-600 hover:text-red-900">
                                                删除
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                                <template x-if="proxyKeys.length === 0">
                                    <tr>
                                        <td colspan="6"
                                            class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">
                                            <template x-if="proxyKeySearch.trim()">
                                                <span>未找到匹配的代理密钥</span>
                                            </template>
                                            <template x-if="!proxyKeySearch.trim()">
                                                <span>暂无代理密钥</span>
                                            </template>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>

                    <!-- 分页控件 -->
                    <div x-show="proxyKeyPagination.total > 0"
                        class="mt-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                        <!-- 分页信息 -->
                        <div class="text-sm text-gray-700">
                            显示第
                            <span class="font-medium"
                                x-text="((proxyKeyPagination.page - 1) * proxyKeyPagination.page_size + 1)"></span>
                            到
                            <span class="font-medium"
                                x-text="Math.min(proxyKeyPagination.page * proxyKeyPagination.page_size, proxyKeyPagination.total)"></span>
                            条，共
                            <span class="font-medium" x-text="proxyKeyPagination.total"></span>
                            条记录
                        </div>

                        <!-- 分页按钮 -->
                        <div class="flex items-center space-x-2">
                            <!-- 上一页 -->
                            <button @click="goToProxyKeyPage(proxyKeyPagination.page - 1)"
                                :disabled="!proxyKeyPagination.has_prev"
                                :class="proxyKeyPagination.has_prev ? 'text-gray-500 hover:text-gray-700' : 'text-gray-300 cursor-not-allowed'"
                                class="px-3 py-2 text-sm font-medium border border-gray-300 rounded-md">
                                上一页
                            </button>

                            <!-- 页码 -->
                            <template x-for="page in Array.from({length: Math.min(5, proxyKeyPagination.total_pages)}, (_, i) => {
                                const start = Math.max(1, proxyKeyPagination.page - 2);
                                const end = Math.min(proxyKeyPagination.total_pages, start + 4);
                                const adjustedStart = Math.max(1, end - 4);
                                return adjustedStart + i;
                            }).filter(p => p <= proxyKeyPagination.total_pages)" :key="page">
                                <button @click="goToProxyKeyPage(page)"
                                    :class="page === proxyKeyPagination.page ? 'bg-indigo-500 text-white' : 'text-gray-500 hover:text-gray-700'"
                                    class="px-3 py-2 text-sm font-medium border border-gray-300 rounded-md">
                                    <span x-text="page"></span>
                                </button>
                            </template>

                            <!-- 下一页 -->
                            <button @click="goToProxyKeyPage(proxyKeyPagination.page + 1)"
                                :disabled="!proxyKeyPagination.has_next"
                                :class="proxyKeyPagination.has_next ? 'text-gray-500 hover:text-gray-700' : 'text-gray-300 cursor-not-allowed'"
                                class="px-3 py-2 text-sm font-medium border border-gray-300 rounded-md">
                                下一页
                            </button>
                        </div>
                    </div>

                    <!-- 编辑代理密钥模态框 -->
                    <div x-show="showEditProxyKeyModal" x-cloak
                        class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 p-4">
                        <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
                            <!-- 头部 -->
                            <div class="flex justify-between items-center p-6 border-b border-gray-200">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                                        <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                            </path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-900">编辑代理密钥</h3>
                                        <p class="text-sm text-gray-500">修改代理密钥的配置信息</p>
                                    </div>
                                </div>
                                <button @click="closeEditProxyKeyModal()"
                                    class="text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>

                            <!-- 内容区域 -->
                            <div class="flex-1 overflow-y-auto p-6">
                                <form id="editProxyKeyForm" @submit.prevent="updateProxyKey()" class="space-y-6">
                                    <!-- 基本信息 -->
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-gray-800 mb-4">
                                            基本信息
                                        </h4>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">密钥名称
                                                    *</label>
                                                <input type="text" x-model="editingProxyKey.name" required
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="输入密钥名称" />
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">描述</label>
                                                <input type="text" x-model="editingProxyKey.description"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="输入描述信息" />
                                            </div>
                                        </div>
                                        <div class="mt-4">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="editingProxyKey.is_active"
                                                    class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" />
                                                <span class="ml-2 text-sm font-medium text-gray-700">启用密钥</span>
                                            </label>
                                        </div>
                                    </div>

                                    <!-- 分组权限 -->
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-gray-800 mb-4">
                                            分组权限
                                        </h4>
                                        <div class="bg-white rounded-lg border border-gray-200 p-3">
                                            <label class="block text-sm font-medium text-gray-700 mb-3">允许访问的分组</label>
                                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 max-h-40 overflow-y-auto">
                                                <template x-for="(provider, groupId) in providerStatuses"
                                                    :key="groupId">
                                                    <label
                                                        class="flex items-center space-x-2 p-2 hover:bg-gray-50 rounded">
                                                        <input type="checkbox" :value="groupId"
                                                            :checked="editingProxyKey.allowed_groups.includes(groupId)"
                                                            @change="toggleEditingProxyKeyGroup(groupId, $event.target.checked)"
                                                            class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" />
                                                        <span class="text-sm" x-text="provider.group_name"></span>
                                                    </label>
                                                </template>
                                            </div>
                                            <p class="text-xs text-gray-500 mt-2">
                                                不选择任何分组表示可以访问所有分组
                                            </p>
                                        </div>
                                    </div>

                                    <!-- 分组间请求设置 -->
                                    <div x-show="editingProxyKey.allowed_groups.length > 1 || editingProxyKey.allowed_groups.length === 0"
                                        class="bg-gray-50 rounded-lg p-4">
                                        <h4 class="text-sm font-medium text-gray-800 mb-4 flex items-center">
                                            <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 9l3 3-3 3m5 0h3"></path>
                                            </svg>
                                            分组间请求设置
                                        </h4>
                                        <div class="bg-white rounded-lg border border-gray-200 p-3">
                                            <div class="mb-4">
                                                <label class="block text-sm font-medium text-gray-700 mb-2">选择策略</label>
                                                <select x-model="editingProxyKey.group_selection_config.strategy"
                                                    @change="onEditingProxyKeyStrategyChange()"
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                                    <option value="round_robin">
                                                        轮询 (Round Robin) -
                                                        在分组间轮流分配请求
                                                    </option>
                                                    <option value="weighted">
                                                        权重 (Weighted) -
                                                        根据权重比例分配请求
                                                    </option>
                                                    <option value="random">
                                                        随机 (Random) -
                                                        随机选择分组
                                                    </option>
                                                    <option value="failover">
                                                        故障转移 (Failover)
                                                        - 按优先级顺序选择
                                                    </option>
                                                </select>
                                            </div>

                                            <!-- 权重配置 -->
                                            <div x-show="editingProxyKey.group_selection_config.strategy === 'weighted'"
                                                class="mt-4">
                                                <label
                                                    class="block text-sm font-medium text-gray-700 mb-3">分组权重配置</label>
                                                <div class="space-y-2">
                                                    <template
                                                        x-for="groupId in getGroupsForWeightConfig(editingProxyKey.allowed_groups)"
                                                        :key="groupId">
                                                        <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded">
                                                            <span class="text-sm font-medium min-w-0 flex-1"
                                                                x-text="getGroupName(groupId)"></span>
                                                            <div class="flex items-center space-x-2">
                                                                <label class="text-xs text-gray-600">权重:</label>
                                                                <input type="number"
                                                                    :value="getEditingGroupWeight(groupId)"
                                                                    @input="setEditingGroupWeight(groupId, $event.target.value)"
                                                                    min="1" max="100"
                                                                    class="w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" />
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-2">
                                                    权重越高，获得的请求越多。例如权重3:1的分组将获得约75%:25%的请求分配。
                                                </p>
                                            </div>

                                            <!-- 故障转移优先级配置 -->
                                            <div x-show="editingProxyKey.group_selection_config.strategy === 'failover'"
                                                class="mt-4">
                                                <label
                                                    class="block text-sm font-medium text-gray-700 mb-3">分组优先级配置</label>
                                                <div class="space-y-2">
                                                    <template
                                                        x-for="groupId in getGroupsForWeightConfig(editingProxyKey.allowed_groups)"
                                                        :key="groupId">
                                                        <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded">
                                                            <span class="text-sm font-medium min-w-0 flex-1"
                                                                x-text="getGroupName(groupId)"></span>
                                                            <div class="flex items-center space-x-2">
                                                                <label class="text-xs text-gray-600">优先级:</label>
                                                                <input type="number"
                                                                    :value="getEditingGroupWeight(groupId)"
                                                                    @input="setEditingGroupWeight(groupId, $event.target.value)"
                                                                    min="1" max="10"
                                                                    class="w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-indigo-500" />
                                                            </div>
                                                        </div>
                                                    </template>
                                                </div>
                                                <p class="text-xs text-gray-500 mt-2">
                                                    数字越小优先级越高。优先使用优先级最高的分组，当该分组不可用时转移到下一优先级。
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- 底部操作 -->
                            <div class="border-t border-gray-200 px-6 py-4 bg-gray-50 rounded-b-lg">
                                <div class="flex justify-between items-center">
                                    <div class="text-sm text-gray-500">
                                        修改完成后点击更新保存
                                    </div>
                                    <div class="flex space-x-3">
                                        <button type="button" @click="closeEditProxyKeyModal()"
                                            class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                            取消
                                        </button>
                                        <button type="submit" form="editProxyKeyForm"
                                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            更新密钥
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Usage Statistics Modal -->
        <div x-show="showKeyUsageStatsModal" x-cloak
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col">
                <!-- Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                            <svg class="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">密钥使用统计</h3>
                            <p class="text-sm text-gray-500" x-show="currentGroupUsageStats">
                                分组: <span x-text="currentGroupUsageStats?.group_name"></span>
                                | 负载策略: <span x-text="currentGroupUsageStats?.balance_policy"></span>
                            </p>
                        </div>
                    </div>
                    <button @click="closeKeyUsageStatsModal()"
                        class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Content -->
                <div class="flex-1 overflow-y-auto p-6">
                    <div x-show="loadingUsageStats" class="flex justify-center items-center py-8">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                        <span class="ml-2 text-gray-600">加载中...</span>
                    </div>

                    <div x-show="!loadingUsageStats && currentGroupUsageStats" class="space-y-6">
                        <!-- Statistics Summary -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600"
                                        x-text="currentGroupUsageStats?.total_keys || 0"></div>
                                    <div class="text-sm text-gray-500">总密钥数</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600"
                                        x-text="(currentGroupUsageStats?.key_stats || []).filter(k => k.is_available).length">
                                    </div>
                                    <div class="text-sm text-gray-500">可用密钥</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-orange-600"
                                        x-text="(currentGroupUsageStats?.key_stats || []).reduce((sum, k) => sum + k.usage_count, 0)">
                                    </div>
                                    <div class="text-sm text-gray-500">总使用次数</div>
                                </div>
                            </div>
                        </div>

                        <!-- Key Statistics Table -->
                        <div class="bg-white border rounded-lg overflow-hidden">
                            <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
                                <h4 class="text-lg font-semibold text-gray-900">密钥详细统计</h4>
                                <button @click="resetGroupUsageStats(currentGroupUsageStats.group_id)"
                                    class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm">
                                    重置统计
                                </button>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                密钥</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                使用次数</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                最后使用</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                状态</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                上次检查状态码</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                操作</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <template x-for="keyStats in currentGroupUsageStats?.key_stats || []"
                                            :key="keyStats.api_key_hash">
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="text-sm font-medium text-gray-900"
                                                            x-text="keyStats.api_key_prefix"></div>
                                                        <div class="text-xs text-gray-500 ml-2"
                                                            x-text="'#' + keyStats.api_key_hash"></div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900" x-text="keyStats.usage_count">
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900"
                                                        x-text="keyStats.last_used ? new Date(keyStats.last_used).toLocaleString() : '从未使用'">
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span
                                                        class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                        :class="keyStats.is_available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                                                        <span x-text="keyStats.is_available ? '可用' : '不可用'"></span>
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="text-sm text-gray-900">
                                                        <span x-show="keyStats.last_status_code"
                                                            class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                                                            :class="keyStats.last_status_code === 200 ? 'bg-green-100 text-green-800' : 
                                                                    keyStats.last_status_code === 401 ? 'bg-red-100 text-red-800' :
                                                                    keyStats.last_status_code >= 400 ? 'bg-red-100 text-red-800' :
                                                                    keyStats.last_status_code >= 300 ? 'bg-yellow-100 text-yellow-800' :
                                                                    'bg-gray-100 text-gray-800'"
                                                            x-text="keyStats.last_status_code">
                                                        </span>
                                                        <span x-show="!keyStats.last_status_code"
                                                            class="text-xs text-gray-400">
                                                            未检查
                                                        </span>
                                                    </div>
                                                    <div x-show="keyStats.last_validated_at"
                                                        class="text-xs text-gray-500">
                                                        <span
                                                            x-text="new Date(keyStats.last_validated_at).toLocaleString()"></span>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                    <button @click="openForceUpdateModal(keyStats)"
                                                        class="text-indigo-600 hover:text-indigo-900 mr-3">
                                                        强制更新
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div x-show="!loadingUsageStats && !currentGroupUsageStats" class="text-center py-8">
                        <div class="text-gray-500">无法加载使用统计数据</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Force Update Key Status Modal -->
        <div x-show="showForceUpdateModal" x-cloak
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
            x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
            <div class="bg-white rounded-lg shadow-2xl w-full max-w-md">
                <!-- Header -->
                <div class="flex justify-between items-center p-6 border-b border-gray-200">
                    <h3 class="text-lg font-bold text-gray-900">强制更新密钥状态</h3>
                    <button @click="closeForceUpdateModal()"
                        class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <!-- Content -->
                <div class="p-6">
                    <div x-show="selectedForceUpdateKey" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">目标密钥</label>
                            <div class="p-3 bg-gray-50 rounded border">
                                <div class="text-sm font-medium" x-text="selectedForceUpdateKey?.api_key_prefix"></div>
                                <div class="text-xs text-gray-500"
                                    x-text="'Hash: ' + selectedForceUpdateKey?.api_key_hash"></div>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">新状态</label>
                            <select x-model="forceUpdateStatus"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="valid">有效 (valid)</option>
                                <option value="invalid">无效 (invalid)</option>
                            </select>
                        </div>

                        <div class="flex space-x-3 pt-4">
                            <button @click="submitForceUpdate()"
                                class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md">
                                确认更新
                            </button>
                            <button @click="closeForceUpdateModal()"
                                class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md">
                                取消
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Settings Modal -->
        <div x-show="showUserSettingsModal" x-cloak
            class="fixed inset-0 bg-black bg-opacity-50 flex items-start sm:items-center justify-center z-50 p-4 overflow-y-auto"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100"
            x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100"
            x-transition:leave-end="opacity-0">
            <div
                class="bg-white rounded-lg p-4 sm:p-6 w-full max-w-md shadow-xl my-4 sm:my-0 min-h-0 max-h-screen overflow-y-auto">
                <!-- 标题区域 - 移动端优化 -->
                <div
                    class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 space-y-2 sm:space-y-0">
                    <div class="flex-1">
                        <h3 class="text-lg sm:text-xl font-bold text-gray-900">账户设置</h3>
                        <p class="text-xs sm:text-sm text-gray-500">修改您的用户名和密码</p>
                    </div>
                    <button @click="closeUserSettingsModal()"
                        class="self-end sm:self-center p-1 text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>

                <form @submit.prevent="updateUserInfo()" class="space-y-4">
                    <!-- 当前密码 -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            当前密码 <span class="text-red-500">*</span>
                        </label>
                        <input type="password" x-model="userForm.currentPassword"
                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base"
                            placeholder="请输入当前密码" required>
                    </div>

                    <!-- 新用户名 -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            新用户名
                        </label>
                        <input type="text" x-model="userForm.newUsername" :placeholder="`当前: ${user.username}`"
                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                        <p class="text-xs text-gray-500">留空则不修改用户名</p>
                    </div>

                    <!-- 新密码 -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            新密码
                        </label>
                        <input type="password" x-model="userForm.newPassword"
                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base"
                            placeholder="留空则不修改密码" minlength="6">
                        <p class="text-xs text-gray-500">密码长度至少6位</p>
                    </div>

                    <!-- 确认新密码 -->
                    <div x-show="userForm.newPassword" class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700">
                            确认新密码 <span class="text-red-500">*</span>
                        </label>
                        <input type="password" x-model="userForm.confirmPassword"
                            class="w-full px-3 py-2 sm:px-4 sm:py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base"
                            placeholder="请再次输入新密码" :required="userForm.newPassword">
                    </div>

                    <!-- 按钮区域 - 移动端优化 -->
                    <div
                        class="flex flex-col sm:flex-row sm:justify-end space-y-3 sm:space-y-0 sm:space-x-3 mt-6 pt-4 border-t border-gray-200">
                        <button type="button" @click="closeUserSettingsModal()"
                            class="w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition duration-200 order-2 sm:order-1">
                            取消
                        </button>
                        <button type="submit" :disabled="updatingUserInfo"
                            class="w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-md transition duration-200 order-1 sm:order-2">
                            <span x-show="!updatingUserInfo">保存修改</span>
                            <span x-show="updatingUserInfo">保存中...</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div x-show="message" x-cloak x-transition class="fixed top-4 right-4 z-50">
            <div class="px-4 py-2 rounded-md text-white"
                :class="messageType === 'success' ? 'bg-green-500' : 'bg-red-500'">
                <span x-text="message"></span>
            </div>
        </div>
    </div>

    <!-- 自定义确认框模态 -->
    <div id="confirmModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden modal-backdrop">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white modal-animation">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                    <svg class="h-6 w-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z">
                        </path>
                    </svg>
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2">确认操作</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-500 whitespace-pre-line" id="confirmMessage"></p>
                </div>
                <div class="items-center px-4 py-3 space-x-2">
                    <button id="confirmYes"
                        class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-20 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300 transition-colors">
                        确定
                    </button>
                    <button id="confirmNo"
                        class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-20 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-colors">
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定义提示框模态 -->
    <div id="alertModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-50 overflow-y-auto h-full w-full z-50 hidden modal-backdrop">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-lg bg-white modal-animation">
            <div class="mt-3 text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full" id="alertIcon">
                    <!-- 图标将通过 JavaScript 动态设置 -->
                </div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 mt-2" id="alertTitle">提示</h3>
                <div class="mt-2 px-7 py-3">
                    <p class="text-sm text-gray-600 whitespace-pre-line" id="alertMessage"></p>
                </div>
                <div class="items-center px-4 py-3">
                    <button id="alertOk"
                        class="px-4 py-2 bg-blue-500 text-white text-base font-medium rounded-md w-20 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-300 transition-colors">
                        确定
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/dashboard.js"></script>
</body>

</html>